---
allowed-tools: Bash(git diff:*), Bash(git status:*), Bash(git branch:*)
description: Review your changes
---

## Context

- Changed files: !`git diff --name-only HEAD`
- Full diff: !`git diff HEAD`
- Current branch: !`git branch --show-current`

## Your task

変更されたコードを以下の観点から包括的にレビューし、日本語でフィードバックを提供します。

### レビュー観点

#### 🔥 最優先: セキュリティ

コードレビュー結果の Critical に分類

- SQL インジェクション、XSS、CSRF の脆弱性
- 決済処理における機密情報の取り扱い（クレジットカード情報、トークン）
- 認証・認可の適切な実装
- セッション管理の安全性
- ファイルアップロードの検証

#### ⚡ 高優先: バグ・ロジックエラー

コードレビュー結果の Critical に分類

- Null 参照の可能性
- 型の不一致
- 境界値のチェック漏れ
- 例外処理の不備
- エッジケースの考慮不足

#### パフォーマンス

コードレビュー結果の Warning に分類

- N+1 クエリの発生
- 大容量データの処理方法（ストリーム処理 vs メモリロード）
- 不要なループやネストの深さ
- キャッシュの活用可能性
- データベースインデックスの必要性

#### コード品質

コードレビュー結果の Warning に分類

- SOLID原則への準拠
- DDD パターンの適切な使用
- 責務の分離（関心の分離）
- 命名規則の一貫性
- コードの重複（DRY原則）

#### BEAR.Sunday 固有

重大度に応じて Critical/Warning/Suggestion に分類

- DI コンテナの適切な使用
- リソース指向アーキテクチャの遵守
- インターセプターの適切な配置
- ルーティングの設計

#### プロジェクト固有ルール

重大度に応じて Critical/Warning/Suggestion に分類

- エラーハンドリングの統一
- `fopen` 使用時のストリーム処理

### 出力形式

以下の構造で出力：

```
# コードレビュー結果

## 概要
- 変更ファイル数: X件
- 主な変更内容: [簡潔な説明]

## 🔴 Critical（必ず修正）
[セキュリティやバグなど、重大な問題]

## 🟡 Warning（推奨修正）
[パフォーマンスや保守性の問題]

## 🟢 Suggestion（改善提案）
[より良い実装方法の提案]

## ✅ Good Points
[良い実装や改善された点]
```

各指摘には：
- **ファイル名と行番号**を明記
- **問題の説明**を具体的に
- **修正案**をコード例付きで提示
- **理由**を簡潔に説明

### 重要な制約

- **全て日本語で出力**
- 指摘がない場合は「問題は見つかりませんでした」と明記
- コード例は実際に動作するものを提示
- 推測ではなく、実際の diff に基づいて判断
